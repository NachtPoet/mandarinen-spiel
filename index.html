<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mandarinen: Erinnerungen im Gepäck</title>
  <!-- Retro Pixel-Font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <!-- Ergänzende Schriftart für Lyrics -->
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600&display=swap" rel="stylesheet">
  <!-- Stylesheet einbinden -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="star-field"></div>
  <div class="memory-flash"></div>

  <h1>Mandarinen: Erinnerungen im Gepäck</h1>

  <!-- Startbildschirm inkl. Schwierigkeitsauswahl -->
  <div id="startScreen" class="overlay">
    <div class="mandarin-icon"></div>
    <h2>Willkommen zurück!</h2>
    <p>
      Tauche ein in die Welt der Mandarinen und entdecke verschüttete Erinnerungen. Jedes gefundene Wort
      enthüllt einen Teil eines besonderen Liedes.<br>
      Folge der Geschichte durch die Zeit - von der Kindheit bis zum Wiedersehen.
    </p>
    <div class="select-wrapper">
      <label for="difficultySelect">Schwierigkeitsgrad:</label>
      <select id="difficultySelect">
        <option value="easy" selected>Leichtes Gepäck</option>
        <option value="hard">Schweres Gepäck</option>
        <option value="loose">Loch in der Tasche</option>
      </select>
    </div>
    <div class="button-container">
      <button id="startButton" class="btn primary">Spiel fortsetzen</button>
      <button id="startNewButton" class="btn secondary">Neue Reise beginnen</button>
      <button id="helpButton" class="btn">Spielanleitung</button>
    </div>
    <p class="save-notice">Dein Fortschritt und deine Erinnerungen werden automatisch gespeichert.</p>
  </div>

  <!-- Spielbereich -->
  <div id="gameContainer" class="container" style="display:none;">
    <div id="epicBadge" class="epic-badge">Perfekte Runde!</div>
    <div id="levelIndicator">Level: 1/10</div>
    <div id="timer">Zeit: 0:00</div>
    <div id="grid" class="grid"></div>
    <div id="progress"><div id="progressBar"></div></div>
    <div id="wordList" class="word-list"></div>
    <!-- Musik-Toggle-Button innerhalb des Containers -->
    <button id="musicToggle"></button>
    <button id="soundToggle"></button>
    <button id="hintButton">TIPP</button>
  </div>

  <!-- Overlay für Level-Belohnung -->
  <div id="levelOverlay" class="overlay hidden">
    <div id="lyricDisplay" style="white-space: pre-wrap;"></div>
    <div class="level-quote" id="levelQuote"></div>
    <button id="nextLevelButton" class="btn primary">Weiter in der Geschichte</button>
  </div>

  <!-- Emotionaler Endscreen -->
  <div id="endScreen" class="overlay hidden">
    <div class="mandarin-icon"></div>
    <h2>Reise vollendet</h2>
    <p id="endMessage">
      In den Mandarinen liegen Erinnerungen und Verbundenheit –
      du hast die Geschichte des Songs Stück für Stück entdeckt.
    </p>
    <div class="reward-box" id="rewardBox"></div>
    <p id="couponCode">Dein Gutscheincode: MANDARINE10 (10% Rabatt)</p>
    <p><a href="https://shop.alexandrajanzen.de/" target="_blank" class="shop-link">Zum Shop</a></p>
    <div class="button-container">
      <button id="restartButton" class="btn primary">Erneut spielen</button>
      <button id="restartNewButton" class="btn secondary">Neue Reise beginnen</button>
    </div>
    <p class="save-notice">Die Erinnerungen bleiben - du kannst jederzeit mit einem anderen Schwierigkeitsgrad spielen.</p>
  </div>

  <!-- Hilfe-Overlay -->
  <div id="helpOverlay" class="overlay hidden">
    <div class="help-container">
      <div class="help-title">Spielanleitung</div>

      <div class="help-section">
        <h3>Spielziel</h3>
        <p>Finde Wörter im Rätsel und entdecke die Geschichte hinter dem Lied über Erinnerungen, Trennung und Wiedersehen.</p>
      </div>

      <div class="help-section">
        <h3>Steuerung</h3>
        <p>Ziehe über Buchstaben, um Wörter zu markieren (horizontal, vertikal, diagonal).</p>
      </div>

      <div class="help-section">
        <h3>Schwierigkeitsgrade</h3>
        <p>• <strong>Leichtes Gepäck</strong>: Nur horizontal/vertikal<br>
        • <strong>Schweres Gepäck</strong>: Alle Richtungen<br>
        • <strong>Loch in der Tasche</strong>: Nur Anfangsbuchstaben</p>
      </div>

      <div class="help-section">
        <h3>Tipps</h3>
        <p>• Tipp-Button bei Bedarf nutzen<br>
        • Farbwechsel zeigen Stimmung des Levels<br>
        • Die Musik passt sich jedem Level an</p>
      </div>
    </div>
    <button id="closeHelpButton" class="btn">Zurück zur Reise</button>
  </div>

  <!-- Audio-Elemente für Stems direkt im HTML - ohne src Attribute -->
  <audio id="stem-piano" preload="auto" loop></audio>
  <audio id="stem-bass" preload="auto" loop></audio>
  <audio id="stem-drums" preload="auto" loop></audio>
  <audio id="stem-guitars" preload="auto" loop></audio>
  <audio id="stem-others" preload="auto" loop></audio>
  <audio id="stem-vocals" preload="auto" loop></audio>

  <!-- Script zum dynamischen Setzen der Audio-Quellen -->
  <script>
    // Bestimme die Basis-URL der Webseite
    var baseUrl = window.location.origin + '/';
    
    // Bei GitHub Pages mit Repository-Namen ergänzen
    if (window.location.hostname.includes('github.io')) {
      var repo = window.location.pathname.split('/')[1];
      if (repo) baseUrl += repo + '/';
    }
    
    // Bei benutzerdefinierten Domains wie mandarinenspiel.alexandrajanzen.de
    // bleibt baseUrl einfach bei "/"
    
    // Setze Audioquellen mit absoluten Pfaden
    document.getElementById('stem-piano').src = baseUrl + 'assets/audio/stems/01_piano.mp3';
    document.getElementById('stem-bass').src = baseUrl + 'assets/audio/stems/02_bass.mp3';
    document.getElementById('stem-drums').src = baseUrl + 'assets/audio/stems/03_drums.mp3';
    document.getElementById('stem-guitars').src = baseUrl + 'assets/audio/stems/04_guitars.mp3';
    document.getElementById('stem-others').src = baseUrl + 'assets/audio/stems/05_others.mp3';
    document.getElementById('stem-vocals').src = baseUrl + 'assets/audio/stems/06_vocals.mp3';
    
    // Debug-Ausgabe
    console.log('Audio-Basispfad: ' + baseUrl);
    console.log('Erster Audiopfad: ' + document.getElementById('stem-piano').src);
  </script>

  <!-- JavaScript Dateien einbinden -->
  <script src="js/utils.js"></script>
  <script src="js/levels.js"></script>
  <!-- Erst die ursprüngliche AudioManager-Klasse laden: -->
  <script src="js/audioManager.js"></script>
  <!-- Dann die Stem-Audio-Manager-Klasse: -->
  <script src="js/stemAudioManager.js"></script>
  <script src="js/ui.js"></script>
  <!-- GameManager muss nach AudioManager und StemAudioManager geladen werden: -->
  <script src="js/gameManager.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
